<div align="center">

![quark-logo](img/icon.png)

# å¤¸å…‹ç½‘ç›˜è‡ªåŠ¨è½¬å­˜

å¤¸å…‹ç½‘ç›˜ç­¾åˆ°ã€è‡ªåŠ¨è½¬å­˜ã€å‘½åæ•´ç†ã€å‘æ¨é€æé†’å’Œåˆ·æ–°åª’ä½“åº“ä¸€æ¡é¾™ã€‚

å¯¹äºä¸€äº›æŒç»­æ›´æ–°çš„èµ„æºï¼Œéš”æ®µæ—¶é—´å»è½¬å­˜ååˆ†éº»çƒ¦ã€‚

å®šæœŸæ‰§è¡Œæœ¬è„šæœ¬è‡ªåŠ¨è½¬å­˜ã€æ–‡ä»¶åæ•´ç†ï¼Œé…åˆ Alist, rclone, Emby å¯è¾¾åˆ°è‡ªåŠ¨è¿½æ›´çš„æ•ˆæœã€‚ğŸ¥³


[![github tag][gitHub-tag-image]][github-url] [![docker pulls][docker-pulls-image]][docker-url] [![docker image size][docker-image-size-image]][docker-url]

[gitHub-tag-image]: https://img.shields.io/github/v/tag/Cp0204/quark-auto-save
[docker-pulls-image]: https://img.shields.io/docker/pulls/cp0204/quark-auto-save
[docker-image-size-image]: https://img.shields.io/docker/image-size/cp0204/quark-auto-save
[github-url]: https://github.com/Cp0204/quark-auto-save
[docker-url]: https://hub.docker.com/r/cp0204/quark-auto-save

![run_log](img/run_log.png)

</div>

â›”ï¸â›”ï¸â›”ï¸ æ³¨æ„ï¼èµ„æºä¸ä¼šæ¯æ—¶æ¯åˆ»æ›´æ–°ï¼Œ**ä¸¥ç¦è®¾å®šè¿‡é«˜çš„å®šæ—¶è¿è¡Œé¢‘ç‡ï¼** ä»¥å…è´¦å·å¼‚å¸¸æˆ–ç»™å¤¸å…‹æœåŠ¡å™¨é€ æˆä¸å¿…è¦çš„å‹åŠ›ã€‚é›ªå±±å´©å¡Œï¼Œæ¯ä¸€ç‰‡é›ªèŠ±éƒ½æœ‰è´£ä»»ï¼

## åŠŸèƒ½

- éƒ¨ç½²æ–¹å¼
  - [x] å…¼å®¹é’é¾™
  - [x] æ”¯æŒ Docker ç‹¬ç«‹éƒ¨ç½²ï¼ŒWebUI é…ç½®

- åˆ†äº«é“¾æ¥
  - [x] æ”¯æŒåˆ†äº«é“¾æ¥çš„å­ç›®å½•
  - [x] è®°å½•å¤±æ•ˆåˆ†äº«å¹¶è·³è¿‡ä»»åŠ¡

- æ–‡ä»¶ç®¡ç†
  - [x] ç›®æ ‡ç›®å½•ä¸å­˜åœ¨æ—¶è‡ªåŠ¨æ–°å»º
  - [x] è·³è¿‡å·²è½¬å­˜è¿‡çš„æ–‡ä»¶
  - [x] æ­£åˆ™è¿‡æ»¤è¦è½¬å­˜çš„æ–‡ä»¶å
  - [x] è½¬å­˜åæ–‡ä»¶åæ•´ç†ï¼ˆæ­£åˆ™æ›¿æ¢ï¼‰
  - [x] å¯é€‰å¿½ç•¥æ–‡ä»¶åç¼€

- ä»»åŠ¡ç®¡ç†
  - [x] æ”¯æŒå¤šç»„ä»»åŠ¡
  - [x] ä»»åŠ¡ç»“æŸæœŸé™ï¼ŒæœŸé™åä¸æ‰§è¡Œæ­¤ä»»åŠ¡
  - [x] å¯å•ç‹¬æŒ‡å®šå­ä»»åŠ¡æ˜ŸæœŸå‡ æ‰§è¡Œ

- åª’ä½“åº“æ•´åˆ
  - [x] æ ¹æ®ä»»åŠ¡åæœç´¢ Emby åª’ä½“åº“
  - [x] è¿½æ›´æˆ–æ•´ç†åè‡ªåŠ¨åˆ·æ–° Emby åª’ä½“åº“

- å…¶å®ƒ
  - [x] æ¯æ—¥ç­¾åˆ°é¢†ç©ºé—´
  - [x] æ”¯æŒå¤šä¸ªé€šçŸ¥æ¨é€æ¸ é“
  - [x] æ”¯æŒå¤šè´¦å·ï¼ˆå¤šè´¦å·ç­¾åˆ°ï¼Œä»…é¦–è´¦å·è½¬å­˜ï¼‰

## ä½¿ç”¨

### Docker éƒ¨ç½²

æä¾› WebUI ç®¡ç†é…ç½®ï¼Œä½†ç›®å‰ WebUI å¹¶ä¸å®Œå–„ï¼Œåªä¾›è¾…åŠ©ä½¿ç”¨ï¼Œä½ ä¹Ÿåº”è¯¥äº†è§£å¦‚ä½•[æ‰‹åŠ¨é…ç½®](#ç¨‹åºé…ç½®)ã€‚

```shell
docker run -d \
  --name quark-auto-save \
  -p 5005:5005 \
  -v ./quark-auto-save/config:/app/config \
  -v /etc/localtime:/etc/localtime \
  --network bridge \
  --restart unless-stopped \
  cp0204/quark-auto-save:latest
```

é»˜è®¤ç®¡ç†è´¦å· `admin` ï¼Œå¯†ç  `admin123`ï¼Œä»…æ”¯æŒåœ¨ `quark_config.json` ä¸­ä¿®æ”¹ã€‚

#### ä¸€é”®æ›´æ–°

```shell
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower -cR quark-auto-save
```

<details>
<summary>WebUI é¢„è§ˆ</summary>

![screenshot_webui](img/screenshot_webui.png)

</details>

### é’é¾™éƒ¨ç½²

1. æ‹‰åº“å‘½ä»¤ï¼š

    ```
    ql repo https://github.com/Cp0204/quark-auto-save.git "quark" "" "sendNotify"
    ```

2. é¦–æ¬¡è¿è¡Œç¨‹åºå°†ä»æœ¬ä»“åº“ä¸‹è½½é…ç½®æ¨¡ç‰ˆã€‚

3. è„šæœ¬ç®¡ç†ä¸­ï¼Œæ‰‹åŠ¨ç¼–è¾‘ `quark_config.json` é…ç½®æ–‡ä»¶ã€‚

> å½“æ— é…ç½®æ–‡ä»¶æ—¶ä¸”å­˜åœ¨é’é¾™ç¯å¢ƒå˜é‡ `QUARK_COOKIE` æ—¶ï¼Œåˆ™ä»…ç­¾åˆ°ï¼Œå¤šè´¦å·ç”¨æ¢è¡Œåˆ†éš”ã€‚

### ç¨‹åºé…ç½®

é¦–æ¬¡è¿è¡Œè„šæœ¬å°†ä»æœ¬ä»“åº“ä¸‹è½½ `quark_config.json` é…ç½®æ¨¡ç‰ˆï¼š

```json
{
  "cookie": [ //è¯·ç”¨æ‰‹æœºéªŒè¯ç ç™»å½•ï¼ŒCKæ¯”è¾ƒå®Œæ•´ï¼
    "Your pan.quark.cn Cookie1, Only this one will do save task.",
    "Your pan.quark.cn Cookie2, Only sign after this."
  ],
  "push_config": { //æ— æ­¤å­—æ®µåˆ™ä»ç¯å¢ƒå˜é‡ï¼ˆé’é¾™è®¾ç½®ï¼‰è¯»å–é€šçŸ¥è®¾ç½®
    "QUARK_SIGN_NOTIFY": true, //æ˜¯å¦å‘é€ç­¾åˆ°æˆåŠŸé€šçŸ¥ï¼Œä¹Ÿå¯åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®
    "QYWX_AM": "",
    "å…¶ä»–æ¨é€æ¸ é“//æ­¤é¡¹å¯åˆ ": "é…ç½®æ–¹æ³•åŒé’é¾™"
  },
  "emby": {
    "url": "http://yourdomain.com:8096",
    "apikey": "" //åœ¨åå° é«˜çº§-APIç§˜é’¥ ä¸­ç”Ÿæˆ
  },
  "tasklist": [ //æ— ä»»åŠ¡åˆ™åªç­¾åˆ°
    {
      "taskname": "é¸£xxå¹´",
      "shareurl": "https://pan.quark.cn/s/39xxxx35#/list/share/17xxxx72-é¸£xxå¹´",
      "savepath": "/video/tv/é¸£xxå¹´/S01",
      "pattern": "^å¹¿å‘Šå†…å®¹(\\d+).(mp4|mkv)",
      "replace": "\\1.\\2",
      "enddate": "2024-01-30",  //å¯é€‰ï¼Œç»“æŸæ—¥æœŸ
      "emby_id": "",            //å¯é€‰ï¼Œç¼ºçœæ—¶æŒ‰tasknameæœç´¢åŒ¹é…ï¼Œä¸º0æ—¶å¼ºåˆ¶ä¸åŒ¹é…
      "ignore_extension": true, //å¯é€‰ï¼Œå¿½ç•¥åç¼€
      "runweek": [1, 2, 3, 4, 6, 7], //å¯é€‰ï¼ŒæŒ‡å®šæ˜ŸæœŸå‡ æ‰§è¡Œï¼Œæ— æ­¤å­—æ®µåˆ™å‡æ‰§è¡Œ
      "update_subdir": "", // å¯é€‰ï¼Œå­ç›®å½•é€’å½’æ›´æ–°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚ "4k|1080p"
      // ä»¥ä¸‹å­—æ®µæ— éœ€é…ç½®
      "shareurl_ban": "åˆ†äº«åœ°å€å·²å¤±æ•ˆ" //è®°å½•åˆ†äº«æ˜¯å¦å¤±æ•ˆï¼›å¦‚æœ‰æ­¤å­—æ®µå°†è·³è¿‡ä»»åŠ¡ï¼Œæ›´æ–°é“¾æ¥åè¯·æ‰‹åŠ¨åˆ å»
    }
  ]
}
```

### æ­£åˆ™æ•´ç†ç¤ºä¾‹

| pattern | replace | æ•ˆæœ |
| ------- |---------|------|
| `.*` |  | æ— è„‘è½¬å­˜æ‰€æœ‰æ–‡ä»¶ï¼Œä¸æ•´ç† |
| `\.mp4$` |  | è½¬å­˜æ‰€æœ‰ `.mp4` åç¼€çš„æ–‡ä»¶ |
| `^ã€ç”µå½±TTã€‘å½¢ä¼¼èµ°è‚‰(\d+)\.(mp4\|mkv)` | `\1.\2` | ã€ç”µå½±TTã€‘å½¢ä¼¼èµ°è‚‰01.mp4 â†’ 01.mp4<br>ã€ç”µå½±TTã€‘å½¢ä¼¼èµ°è‚‰02.mkv â†’ 02.mkv |
| `^(\d+)\.mp4` | `S02E\1.mp4` | 01.mp4 â†’ S02E01.mp4<br>02.mp4 â†’ S02E02.mp4 |
| `$TV` |  | [é­”æ³•åŒ¹é…](#é­”æ³•åŒ¹é…)å‰§é›†æ–‡ä»¶ |

> [!IMPORTANT]
> ç›´æ¥å†™ json é…ç½®æ³¨æ„`\`å¤šåŠ ä¸€é‡[å­—ç¬¦è½¬ä¹‰](https://deerchao.cn/tutorials/regex/regex.htm#escape)ï¼šå¦‚`\d`å†™ä½œ`\\d`ï¼ŒåŒ¹é…å­—ç¬¦`.`å†™ä½œ`\\.`

#### å‚è€ƒèµ„æ–™

- [æ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹](https://deerchao.cn/tutorials/regex/regex.htm)

- æ›¿æ¢çš„[åå‘å¼•ç”¨](https://deerchao.cn/tutorials/regex/regex.htm#backreference)ï¼šæœ‰äº›è¯­è¨€å†™ä½œ`$1`ï¼ŒPythonä¸­å†™ä½œ`\1`ï¼Œjson è½¬ä¹‰åä¸º`\\1`

### ç‰¹æ®Šåœºæ™¯ä½¿ç”¨æŠ€å·§

#### å¿½ç•¥åç¼€

- å½“ç›®å½•å·²å­˜*01.mp4ã€02.mp4*ï¼Œæ–°çš„æºåˆæœ‰*01.mkvã€02.mkvã€03.mkv*ï¼Œåªå¸Œæœ›è·å¾—*03.mkv*æ›´æ–°æ—¶ã€‚

- ä¸€ä¸ªéƒ¨å‰§åŒæ—¶è¿½æ›´ä¸¤ä¸ªæºï¼Œçœ‹è°æ›´æ–°å¿«ğŸ¤ªï¼Œä½†ä¸¤ä¸ªæºçš„è§†é¢‘æ ¼å¼ä¸ä¸€æ—¶ã€‚

#### ä½¿ç”¨é’é¾™é€šçŸ¥è®¾ç½®

åˆ å»é…ç½®æ–‡ä»¶ä¸­çš„æ•´ä¸ª `push_config` æ•°ç»„ã€‚

#### è‡ªåŠ¨åˆ·æ–°åª’ä½“åº“

åŒæ—¶é…ç½® `emby.url` `emby.apikey` å’Œä»»åŠ¡çš„ `emby_id` ï¼Œå°†åœ¨æ–°å­˜æˆ–æ•´ç†åè‡ªåŠ¨åˆ·æ–° Emby åª’ä½“åº“ã€åˆ·æ–°å…ƒæ•°æ®ã€‚

#### é­”æ³•åŒ¹é…

å½“ä»»åŠ¡ `pattern` å€¼ä¸º `$å¼€å¤´` ä¸” `replace` ç•™ç©ºæ—¶ï¼Œå®é™…å°†è°ƒç”¨ç¨‹åºé¢„è®¾çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

å¦‚ `$TV` å¯é€‚é…å’Œè‡ªåŠ¨æ•´ç†å¸‚é¢ä¸Š90%åˆ†äº«å‰§é›†çš„æ–‡ä»¶åæ ¼å¼ï¼Œå…·ä½“å®ç°è§ä»£ç ï¼Œæ¬¢è¿è´¡çŒ®è§„åˆ™ã€‚

## æ‰“èµ

å¦‚æœè¿™ä¸ªé¡¹ç›®è®©ä½ å—ç›Šï¼Œä½ å¯ä»¥æ‰“èµæˆ‘1å—é’±ï¼Œè®©æˆ‘çŸ¥é“å¼€æºæœ‰ä»·å€¼ã€‚è°¢è°¢ï¼

*ç”±äºå¾®ä¿¡é™åˆ¶ï¼Œæ— æ³•åå‘è”ç³»ä»˜æ¬¾äººï¼Œå¦‚éå¿…è¦å¾®ä¿¡ä¸å›å¤ï¼Œé¡¹ç›®é—®é¢˜è¯·åœ¨ GitHub æ Issue ã€‚* ğŸ˜‰

![WeChatPay](img/wechat_pay_qrcode.png)

## å£°æ˜

æœ¬ç¨‹åºä¸ºä¸ªäººå…´è¶£å¼€å‘ï¼Œå¼€æºä»…ä¾›å­¦ä¹ ä¸äº¤æµä½¿ç”¨ã€‚

ç¨‹åºæ²¡æœ‰ä»»ä½•ç ´è§£è¡Œä¸ºï¼Œåªæ˜¯å¯¹äºå¤¸å…‹å·²æœ‰çš„APIè¿›è¡Œå°è£…ï¼Œæ‰€æœ‰æ•°æ®æ¥è‡ªäºå¤¸å…‹å®˜æ–¹APIï¼Œæœ¬äººä¸å¯¹ç½‘ç›˜å†…å®¹è´Ÿè´£ã€ä¸å¯¹å¤¸å…‹å®˜æ–¹APIæœªæ¥å¯èƒ½çš„æ”¹åŠ¨å¯¼è‡´çš„åæœè´Ÿè´£ã€‚